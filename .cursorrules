# Cursor Rules - MQL5 EA Development

## ğŸ”„ Auto Build & Check Workflow

### âš¡ Tá»± Äá»™ng Cháº¡y Command

Sau má»—i láº§n chá»‰nh sá»­a file `.mq5` hoáº·c `.mqh`, Cursor **PHáº¢I Tá»° Äá»˜NG** cháº¡y:

```powershell
.agent/commands/build-and-check.ps1
```

### ğŸ“‹ Quy TrÃ¬nh Tá»± Äá»™ng

1. **Compile EA** - Cháº¡y MetaEditor CLI Ä‘á»ƒ compile
2. **Äá»c log file** - Tá»± Ä‘á»™ng Ä‘á»£i vÃ  Ä‘á»c log sau khi compile
3. **PhÃ¢n tÃ­ch káº¿t quáº£** - TrÃ­ch xuáº¥t errors/warnings tá»« log
4. **Hiá»ƒn thá»‹ káº¿t quáº£** - Format rÃµ rÃ ng vá»›i mÃ u sáº¯c
5. **Äá» xuáº¥t fix** - Gá»£i Ã½ cÃ¡ch sá»­a lá»—i náº¿u cÃ³

### ğŸ¯ Khi NÃ o Cháº¡y

Cursor tá»± Ä‘á»™ng cháº¡y command khi:
- âœ… **Sau khi edit** file `.mq5` hoáº·c `.mqh` vÃ  save
- âœ… **User yÃªu cáº§u** "compile EA", "check errors", "build EA"
- âœ… **TrÆ°á»›c khi commit** code changes (náº¿u cÃ³ git hook)
- âœ… **Khi user há»i** "cÃ³ lá»—i gÃ¬ khÃ´ng?" hoáº·c "EA compile Ä‘Æ°á»£c chÆ°a?"

### ğŸ“Š Káº¿t Quáº£

**âœ… Success (exit code 0):**
- "0 error(s)" â†’ Continue, cÃ³ thá»ƒ commit
- Hiá»ƒn thá»‹ warnings náº¿u cÃ³ (khÃ´ng block)

**âŒ Failed (exit code 1):**
- "X error(s)" â†’ **KHÃ”NG commit**, hiá»ƒn thá»‹ errors chi tiáº¿t
- List errors vá»›i file vÃ  line number
- Äá» xuáº¥t cÃ¡ch fix

### ğŸ“ Files LiÃªn Quan

- **Command Script**: `.agent/commands/build-and-check.ps1`
- **Workflow Docs**: `.agent/workflows/build-ea.md`
- **This Rules File**: `.cursorrules`

### ğŸ”§ Custom Paths

Náº¿u paths khÃ¡c, cÃ³ thá»ƒ override:

```powershell
.agent/commands/build-and-check.ps1 `
    -EAPath "custom/path/to/ea.mq5" `
    -MetaEditor "custom/path/to/metaeditor64.exe"
```

### ğŸ’¡ LÆ°u Ã

- Command script tá»± Ä‘á»™ng detect paths tá»« EA file
- Log file Ä‘Æ°á»£c táº¡o cÃ¹ng thÆ° má»¥c vá»›i EA file
- Timeout: 5 giÃ¢y Ä‘á»ƒ Ä‘á»£i log file xuáº¥t hiá»‡n
- Exit code: 0 = success, 1 = failed (Cursor sáº½ dá»±a vÃ o Ä‘Ã¢y)

---

## ğŸ“š Auto Update Knowledge (Docs)

### âš¡ Tá»± Äá»™ng Cáº­p Nháº­t Documentation

Khi cÃ³ thay Ä‘á»•i vá» code, logic, hoáº·c yÃªu cáº§u tá»« user, Cursor **PHáº¢I Tá»° Äá»˜NG** cáº­p nháº­t docs tÆ°Æ¡ng á»©ng.

### ğŸ“‹ Quy Táº¯c Cáº­p Nháº­t Docs

1. **Cáº­p nháº­t docs gá»‘c** - KHÃ”NG táº¡o file má»›i vá»›i timeline/version
2. **Cáº­p nháº­t trá»±c tiáº¿p** - Sá»­a file docs hiá»‡n cÃ³, khÃ´ng táº¡o báº£n sao
3. **Giá»¯ cáº¥u trÃºc** - Giá»¯ nguyÃªn cáº¥u trÃºc thÆ° má»¥c `docs/v2/`
4. **Cáº­p nháº­t Ä‘Ãºng file** - TÃ¬m vÃ  cáº­p nháº­t file docs liÃªn quan Ä‘áº¿n thay Ä‘á»•i

### ğŸ¯ Khi NÃ o Cáº­p Nháº­t

Cursor tá»± Ä‘á»™ng cáº­p nháº­t docs khi:
- âœ… **Thay Ä‘á»•i code logic** â†’ Cáº­p nháº­t `docs/v2/code_logic/*.md`
- âœ… **Thay Ä‘á»•i business rules** â†’ Cáº­p nháº­t `docs/v2/business/*.md`
- âœ… **Thay Ä‘á»•i configuration** â†’ Cáº­p nháº­t `docs/v2/business/07_CONFIGURATION.md`
- âœ… **Thay Ä‘á»•i entry rules** â†’ Cáº­p nháº­t `docs/v2/business/ENTRY_RULES.md`
- âœ… **Thay Ä‘á»•i risk management** â†’ Cáº­p nháº­t `docs/v2/business/RISK_MANAGEMENT_RULES.md`
- âœ… **Thay Ä‘á»•i detectors** â†’ Cáº­p nháº­t `docs/v2/code_logic/02_DETECTORS.md`
- âœ… **User yÃªu cáº§u** "update docs", "cáº­p nháº­t tÃ i liá»‡u", "fix documentation"

### ğŸ“ Mapping Code â†’ Docs

| Code File | Documentation File |
|-----------|-------------------|
| `Include/detectors.mqh` | `docs/v2/code_logic/02_DETECTORS.md` |
| `Include/arbiter.mqh` | `docs/v2/code_logic/03_ARBITER.md` |
| `Include/executor.mqh` | `docs/v2/code_logic/04_EXECUTOR.md` |
| `Include/risk_manager.mqh` | `docs/v2/code_logic/05_RISK_MANAGER.md` |
| `Include/stats_manager.mqh` | `docs/v2/code_logic/06_STATS_DASHBOARD.md` |
| `Experts/V2-oat.mq5` | `docs/v2/code_logic/08_MAIN_FLOW.md` |
| Config parameters | `docs/v2/business/07_CONFIGURATION.md` |
| Entry logic | `docs/v2/business/ENTRY_RULES.md` |
| Risk rules | `docs/v2/business/RISK_MANAGEMENT_RULES.md` |
| Trading rules | `docs/v2/business/TRADING_RULES.md` |
| System overview | `docs/v2/business/01_SYSTEM_OVERVIEW.md` |

### âŒ KHÃ”NG ÄÆ¯á»¢C LÃ€M

- âŒ **KHÃ”NG** táº¡o file má»›i vá»›i tÃªn `*_v2.md`, `*_2025.md`, `*_updated.md`
- âŒ **KHÃ”NG** táº¡o file timeline hoáº·c changelog riÃªng
- âŒ **KHÃ”NG** giá»¯ láº¡i version cÅ© trong cÃ¹ng file
- âŒ **KHÃ”NG** táº¡o file backup trong docs folder

### âœ… PHáº¢I LÃ€M

- âœ… **Cáº­p nháº­t trá»±c tiáº¿p** file docs gá»‘c
- âœ… **Giá»¯ nguyÃªn tÃªn file** vÃ  cáº¥u trÃºc
- âœ… **Cáº­p nháº­t ná»™i dung** theo thay Ä‘á»•i má»›i nháº¥t
- âœ… **XÃ³a thÃ´ng tin cÅ©** náº¿u khÃ´ng cÃ²n Ä‘Ãºng
- âœ… **ThÃªm thÃ´ng tin má»›i** náº¿u cÃ³ tÃ­nh nÄƒng má»›i

### ğŸ” Quy TrÃ¬nh Cáº­p Nháº­t

1. **XÃ¡c Ä‘á»‹nh file docs cáº§n cáº­p nháº­t** - Dá»±a vÃ o code file Ä‘Ã£ thay Ä‘á»•i
2. **Äá»c file docs hiá»‡n táº¡i** - Hiá»ƒu ná»™i dung hiá»‡n cÃ³
3. **So sÃ¡nh vá»›i code má»›i** - TÃ¬m Ä‘iá»ƒm khÃ¡c biá»‡t
4. **Cáº­p nháº­t docs** - Sá»­a trá»±c tiáº¿p file docs gá»‘c
5. **XÃ³a thÃ´ng tin cÅ©** - Loáº¡i bá» pháº§n khÃ´ng cÃ²n Ä‘Ãºng
6. **ThÃªm thÃ´ng tin má»›i** - Bá»• sung logic/tÃ­nh nÄƒng má»›i

### ğŸ“ VÃ­ Dá»¥

**Khi thay Ä‘á»•i `detectors.mqh`:**
- âœ… Cáº­p nháº­t: `docs/v2/code_logic/02_DETECTORS.md`
- âŒ KHÃ”NG táº¡o: `docs/v2/code_logic/02_DETECTORS_v2.md`

**Khi thay Ä‘á»•i entry logic:**
- âœ… Cáº­p nháº­t: `docs/v2/business/ENTRY_RULES.md`
- âŒ KHÃ”NG táº¡o: `docs/v2/business/ENTRY_RULES_updated.md`

**Khi user yÃªu cáº§u "cáº­p nháº­t docs vá» DCA":**
- âœ… Cáº­p nháº­t: `docs/v2/business/DCA_MECHANISM.md`
- âŒ KHÃ”NG táº¡o file má»›i

---

## ğŸ“‹ Capture Requirements & Generate Knowledge

### âš¡ Tá»± Äá»™ng Táº¡o Knowledge Files

Khi user yÃªu cáº§u thay Ä‘á»•i/update code, Cursor **PHáº¢I Tá»° Äá»˜NG**:

1. **Capture yÃªu cáº§u** - Ghi láº¡i Ä‘áº§y Ä‘á»§ yÃªu cáº§u tá»« user
2. **PhÃ¢n tÃ­ch context** - TÃ¬m files, docs, rules liÃªn quan
3. **Táº¡o knowledge file** - Format AI-readable trong `.agent/knowledge/`
4. **Äá»c knowledge trÆ°á»›c khi implement** - Äáº£m báº£o hiá»ƒu chÃ­nh xÃ¡c

### ğŸ“ Knowledge File Format

Knowledge file chá»©a:
- **Metadata**: Date, ID, Status, Priority
- **User Request**: YÃªu cáº§u gá»‘c (giá»¯ nguyÃªn)
- **Detailed Requirements**: Chi tiáº¿t cáº§n thay Ä‘á»•i
- **Business Rules**: Rules liÃªn quan
- **Technical Constraints**: Constraints cáº§n tuÃ¢n thá»§
- **Context**: Related files, current implementation
- **Acceptance Criteria**: TiÃªu chÃ­ hoÃ n thÃ nh
- **Implementation Notes**: Notes trong quÃ¡ trÃ¬nh lÃ m

### ğŸ¯ Khi NÃ o Táº¡o Knowledge File

Cursor tá»± Ä‘á»™ng táº¡o knowledge file khi:
- âœ… User yÃªu cáº§u "thay Ä‘á»•i code", "update logic", "sá»­a bug"
- âœ… User yÃªu cáº§u "thÃªm tÃ­nh nÄƒng", "modify behavior"
- âœ… User yÃªu cáº§u "refactor", "optimize"
- âœ… Báº¥t ká»³ yÃªu cáº§u nÃ o liÃªn quan Ä‘áº¿n code changes

### ğŸ“ File Location

- **Knowledge files**: `.agent/knowledge/REQ-YYYYMMDD-HHMMSS.md`
- **Current requirement**: `.agent/knowledge/current-requirement.md`
- **Workflow**: `.agent/workflows/capture-requirements.md`

### ğŸ” Quy TrÃ¬nh

1. **User yÃªu cáº§u** â†’ Cursor capture
2. **Táº¡o knowledge file** â†’ Format structured
3. **Äá»c knowledge** â†’ Hiá»ƒu requirements
4. **Implement** â†’ Theo knowledge file
5. **Update knowledge** â†’ Track progress
6. **Mark complete** â†’ Khi hoÃ n thÃ nh

### âœ… Requirements cho Knowledge File

Knowledge file PHáº¢I chá»©a:
- âœ… User request gá»‘c (khÃ´ng paraphrase)
- âœ… Files cáº§n thay Ä‘á»•i (náº¿u biáº¿t)
- âœ… Business rules liÃªn quan
- âœ… Technical constraints
- âœ… Current implementation (code snippets)
- âœ… Expected behavior
- âœ… Acceptance criteria
- âœ… Related files vÃ  docs

### ğŸ’¡ LÆ°u Ã

- Knowledge file giÃºp AI hiá»ƒu **chÃ­nh xÃ¡c** requirements
- Format structured Ä‘á»ƒ AI dá»… parse
- LuÃ´n Ä‘á»c knowledge file trÆ°á»›c khi implement
- Update knowledge file trong quÃ¡ trÃ¬nh lÃ m
- Mark complete khi hoÃ n thÃ nh

---

## Code Style Rules

- LuÃ´n ghi log vÃ o bot Ä‘á»ƒ User cÃ³ thá»ƒ debug
- Táº¡o dashboard trong backtest
- Æ¯u tiÃªn sá»± Ä‘Æ¡n giáº£n, dá»… Ä‘á»c vÃ  dá»… báº£o trÃ¬
- LuÃ´n tráº£ lá»i báº±ng tiáº¿ng Viá»‡t, giá»¯ thuáº­t ngá»¯ chuyÃªn ngÃ nh báº±ng tiáº¿ng Anh

